# AWS 주요 서비스 훑어보기

해당 시기에 잘 몰랐던 내용을 위주로 정리했기 때문에 기존에 알고 있던 부분에 대해서 기록되어 있지 않습니다.

## IAM(Identity and Access Management)

AWS에서 사용자, 그룹 및 역할을 생성하고 관리하여 리소스에 대한 엑세스를 안전하게 제어할 수 있는 기능입니다.

### IAM 주요 보안 기능

- 인증: AWS 리소스 엑세스 권한에 대한 인증
- 권한 부여: IAM 정책을 사용하여 사용자 또는 그룹을 대상으로 권한을 지정할 수 있습니다.
- 권한 검증: 각 권한에 대한 엑세스 요청에 대한 검증 기능을 의미합니다.

### USER, GROUP, POLICY

- USER: IAM 서비스를 통해 개인별 자격 증명 생성 및 엑세스 권한이 부여되는 단위를 의미합니다.
- GROUP: 다수를 대상으로 공통된 권한을 부여하기 위해 사용되는 단위를 의미합니다. 이는 각 USER 중 유사한 권한을 가진 여러 사용자들에게 공통된 권한을 부여하기 위해 주로 사용되며 그룹 단위로 사용자, 권한을 관리하기에 용이합니다.
- POLICY: 권한 설정을 위한 정책을 의미합니다. 이는 JSON 형식으로 작성되며 AWS 리소스에 대한 허용/거부, 더 나아가서는 권한 수준도 지정합니다. IAM 정책은 최소 권한 원칙을 준수합니다. 즉 오직 필요한 권한만 부여하여 보안을 강화합니다.

### 권한정책 작성 예시

```JSON
{
  "Version": "policy-version",
  "Statement": [
    {
      "Effect": "allow-or-deny",
      "Action": ["action-name"],
      "Resource": ["resource-arn"],
      "Condition": {
        "condition-operator": {
          "condition-key": "condition-value"
        }
      }
    }
  ]
}
```

> 상세 내역
>
> - **`Version`**: 정책의 버전을 나타냅니다. 현재는 "2012-10-17" 에서 고정되었습니다.
> - **`Statement`**: 정책의 규칙을 나타냅니다. 배열 형태로 여러 개의 규칙을 작성할 수 있습니다.
> - **`Effect`**: 규칙의 적용 여부를 나타냅니다. "allow" 또는 "deny" 중 하나를 선택합니다.
> - **`Action`**: 규칙이 적용되는 작업의 종류를 나타냅니다. 예를 들어 "s3:ListBucket"과 같은 형식으로 작성합니다.
> - **`Resource`**: 규칙이 적용되는 리소스의 ARN (Amazon Resource Name)을 나타냅니다. 예를 들어 "arn:aws:s3:::my-bucket/\*"과 같은 형식으로 작성합니다.
> - **`Condition`**: 규칙이 적용되는 조건을 나타냅니다. 필수는 아니며, 필요한 경우 추가할 수 있습니다. 다양한 조건 연산자를 사용할 수 있습니다. 예를 들어 "IpAddress" 조건 연산자를 사용하면 특정 IP 주소에서만 작업을 수행할 수 있도록 제한할 수 있습니다.

## EC2

### 고정 IP 획득하기

Network & Security의 `Elastic IPs` 라는 항목을 통해 현재 할당받은 IP를 독점할 수 있습니다. 하지만 예상하시는 바와 같이 독점하는 기간에는 요금이 발생합니다. 이를 설정하지 않는다면 인스턴트 중지 및 재실행 시 IP가 변경됩니다.

## AMI

EC2 인스턴스 생성 시 OS 선택란이 있는데 이는 AMI에 속합니다. 즉 인스턴스에 디폴트로 설치될 요소 (OS+@소프트웨어)의 모음을 의미합니다. EC2로 Ubuntu를 설치하면 기본적으로 python이 설치되어 있습니다. 이는 AMI에 Ubuntu와 python 설치가 포함되어 있기 때문입니다.

### 나만의 AMI 구성하기

EC2 인스턴스 생성 후 추가적인 default 설정이나 프로그램 설치를 한 뒤 이를 기반으로 AMI를 생성할 수 있습니다. 그래서 해당 AMI 기반 인스턴스 생성을 하면 완전히 동일한 상태의 인스턴스를 갖게 됩니다. 이는 EBS 스냅샷을 활용한 기능입니다.

## EBS

Elastic Block Store는 EC2에 연결되는 블록 수준의 스토리지 볼륨(컴퓨터로 치면 하드디스크 같은)입니다. EBS 볼륨은 네트워크를 통해 연결되므로 EC2 인스턴스 생성 시 함께 생성되어 연결됩니다. 그래서 인스턴스 생성 시 옵션을 통해 EC2를 종료하더라도 EBS는 남아있게 설정할 수 있습니다.

> 🚨 `주의`  
> EC2 생성 시 default 옵션으로 EBS 종료 시 EBS 함께 종료하도록 설정되어 있습니다. 하지만 EBS를 개별적으로 생성한다면 이러한 옵션이 적용되어 있지 않습니다. 그러므로 EC2 프리티어 사용 시 최대 30GB까지 무료 제공이 될텐데 이 용량에서 따로 생성한 EBS도 포함시켜야 합니다. 만약 10GB짜리 EBS가 따로 생성되어 있는 상태에서 EC2 인스턴스를 30GB로 생성한다면 총합이 40GB가 되므로 추가 요금이 발생합니다.

## Elastic Load Balancer

로드 밸런서는 다수의 EC2의 인스턴스를 사용하여 트래픽을 분산시키는 서비스를 제공합니다. 이를 통해 트래픽 문제를 해결할 수 있습니다. 이를 활용하기 위해서는 Route 53을 통해 단일 액세스 포인트 설정이 필요하며 이는 다수의 EC2가 가진 각각의 IP가 하나의 IP 접속과 이어질 수 있도록 하는 장치입니다. 추가적으로 ELB와 연결된 EC2의 헬스 체크가 가능하며 ACM과 연동하여 HTTPS를 제공합니다.

### AWS에서 제공하는 로드 밸런서

1. Application Load Balancer: OSI의 7계층에서 동작합니다. HTTP/HTTPS 트래픽을 처리하며 컨테이너와 연동해서도 사용 가능합니다.
2. Network Load Balancer: OSI 4계층에서 동작하여 TCP/UDP 트래픽을 처리합니다. 그래서 높은 처리량을 필요로 하는 애플리케이션에 적합합니다.
3. Gateway Load Balancer: 서비스 공급자 VPC의 가상 어플라이언스와 소비자 VPC의 어플리케이션 서버 간 프라이빗 연결을 제공합니다.

### AWS에서 로드밸런서 적용 흐름

1. EC2의 `Load balancers 영역`에서 ApplicationLoad Balancer를 통해 `네트워크 맵핑 영역`에서 `Availability Zone을 선택`합니다. (ap-northest-2a, ap-northest-2b...)이는 생성한 인스턴스의 Availability를 참고하여 체크하면 됩니다.
2. 로드밸런서를 위한 `sequrity group`을 만들어 줍니다. 기존 인스턴스 생성 시 사용했던 sg가 큰 차이 없습니다.
3. `Listener and routing` 영역에서 `타겟 그룹을 생성`하는데 이는 하나로 그룹지어 줄 인스턴스들의 묶음을 생성하는 기능이라고 보시면 됩니다.
4. 생성 완료 후 로드밸런서의 DNS에 접속하면 연결되어있는 각각의 인스턴스 중 하나에 접속하게 되며, 새로고침 시 접속하는 인스턴스가 변경되게 됩니다. (이를 통해 동일한 웹서비스를 여러 인스턴스에 배치한다면 하나의 인스턴스에 몰려 트래픽이 높아지는 현상을 분산시킬 수 있습니다.)
5. 로드밸런서의 `target groups` 항목에 들어가면 각 인스턴스의 `헬스 체크`가 가능합니다.
6. 이후 `외부에서 개개인의 인스턴스 IP 접속을 방지` 하기 위해서는 새로운 sg를 생성해야 하는데 `Inbound rules`의 Source를 Custom으로 설정하여 `로드밸런서에 적용된 sg를 선택`합니다.
7. 생성한 sg를 각각의 인스턴스에 적용해주고 기존 sg는 제외합니다. 이렇게 하면 인스턴스에 직접 접속을 막을 수 있습니다.

## Route 53

연간 비용 지불로 도메인을 등록할 수 있습니다. 또한 해당 도메인을 AWS 서비스(EC2, S3 등등)와 연결하는 것을 돕는 서비스 입니다.

### DNS 레코드 타입

도메인 주소(호스트 네임)를 IP주소 또는 타 도메인 주소 등과 서로 연결하고자 할 때 설정하는 타입을 의미합니다.

A 레코드: 호스트네임과 IPv4주소를 연결  
AAAA 레코드: 호스트네임과 IPv6주소를 연결  
CNAME 레코드: 호스트네임을 다른 호스트네임과 연결, 다른 호스트는 A 또는 AAAA 레코드와 연결되어 있어야 함 (ex. 루트 도메인으로 접속할 수 있는 여러 호스트네임을 등록해야하는 상황에 사용한다.)  
NS 레코드: 호스트존의 네임서버를 지정  
Alias 레코드: AWS 전용 레코드로 RDS나 S3 버킷과 같은 서비스를 생성할 경우 제공되는 도메인 주소가 있는데 일반 IP와 호스트네임처럼 생기지 않은 형태를 지니고 있는 도메인을 말한다. 이러한 도메인을 루트 도메인과 연결할 때 alias 레코드 타입을 지정한다.

### TTL

기본적으로 도메인주소를 입력하면 Root Domain, Top-Level Domain(TLD), Second-Level Domain, Third, Fourth까지 쭉쭉 IP주소를 파악하기 위한 네임서버 여정이 시작됩니다. 이 과정을 짧게 하기 위해서 OS에 해당 도메인에 대한 IP주소를 캐시에 저장해 두는데 얼마나 캐시를 보관할지에 대한 시간설정을 TTL(Time to Live)이라는 값을 통해 설정할 수 있습니다. 짧게는 몇 분, 길게는 몇 시간까지 설정합니다.

## ACM

AWS Certificate Manager로 https 적용을 위한 설정을 할 수 있다.
